# Feature Specification: 必要食材個数計算機

**Feature Branch**: `005-ingredient-calculator`
**Created**: 2026-02-02
**Status**: Draft
**Input**: User description: "レシピ（複数選択可能）とその数を指定すると必要な食材の合計数がわかる"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - レシピを選択して必要食材を計算する (Priority: P1)

ユーザーは料理したいレシピを選択し、そのレシピを何回作るかを指定することで、必要な食材の合計数を確認できる。これにより、事前に必要な食材を把握し、効率的にポケモンの食材収集を計画できる。

**Why this priority**: これがこの機能の核心的なユースケースであり、最もシンプルな形で価値を提供できる。1つのレシピでも複数のレシピでも同じUIで操作できる。

**Independent Test**: レシピを選択し、数量を入力すると、必要な食材の合計が正しく表示されることを確認できる。

**Acceptance Scenarios**:

1. **Given** 計算機画面を表示している, **When** 「マメバーグカレー」を選択し数量を1と指定する, **Then** 「マメミート: 7個」と必要食材が表示される
2. **Given** 「マメバーグカレー」が1個選択されている, **When** 数量を3に変更する, **Then** 「マメミート: 21個」と表示が更新される
3. **Given** レシピが選択されている, **When** レシピを削除（選択解除）する, **Then** そのレシピ分の食材が合計から除外される

---

### User Story 2 - 複数のレシピを組み合わせて計算する (Priority: P2)

ユーザーは複数のレシピを同時に選択し、それぞれの数量を指定することで、すべてのレシピに必要な食材の合計を一度に確認できる。同じ食材を使うレシピの場合、食材ごとに合算される。

**Why this priority**: 複数レシピの組み合わせは実際のゲームプレイで頻繁に発生するユースケースであり、P1の機能を自然に拡張したものである。

**Independent Test**: 複数のレシピを選択し、各数量を指定すると、重複する食材が正しく合算されて表示されることを確認できる。

**Acceptance Scenarios**:

1. **Given** 計算機画面を表示している, **When** 「マメバーグカレー」を2個と「ベイビィハニーカレー」を1個選択する, **Then** 「マメミート: 14個、あまいミツ: 7個」と表示される
2. **Given** 2つのレシピが選択されている, **When** 同じ食材を使う「ほっこりホワイトシチュー」を追加する（モーモーミルク使用）, **Then** 同じ食材は合算されて表示される
3. **Given** 複数のレシピが選択されている, **When** 1つのレシピを削除する, **Then** 削除したレシピ分のみが合計から除外され、他のレシピの食材は維持される

---

### User Story 3 - レシピを検索して追加する (Priority: P3)

ユーザーはレシピ名で検索し、素早く目的のレシピを見つけて計算対象に追加できる。大量のレシピから探す手間を省き、効率的に操作できる。

**Why this priority**: レシピ数が多い（77種類）ため、検索機能がないと目的のレシピを見つけるのに時間がかかる。ただしP1/P2が動作すれば最低限の機能は提供できる。

**Independent Test**: 検索ボックスにレシピ名の一部を入力し、該当するレシピがフィルタリングされて表示されることを確認できる。

**Acceptance Scenarios**:

1. **Given** 計算機画面を表示している, **When** 検索ボックスに「カレー」と入力する, **Then** 名前に「カレー」を含むレシピのみが選択候補に表示される
2. **Given** 検索結果が表示されている, **When** 表示されたレシピをクリックする, **Then** そのレシピが計算対象に追加される
3. **Given** 検索ボックスに文字が入力されている, **When** 検索ボックスをクリアする, **Then** すべてのレシピが選択候補に表示される

---

### User Story 4 - 計算結果をリセットする (Priority: P4)

ユーザーはすべての選択をクリアして、新しい計算をやり直すことができる。

**Why this priority**: 利便性向上のための機能であり、個別にレシピを削除しても同様の結果が得られるため優先度は低い。

**Independent Test**: リセットボタンを押すと、すべての選択がクリアされることを確認できる。

**Acceptance Scenarios**:

1. **Given** 複数のレシピが選択されている, **When** リセットボタンを押す, **Then** すべてのレシピ選択がクリアされ、食材合計が0になる
2. **Given** リセット後の状態, **When** 新しいレシピを選択する, **Then** 正常に新しい計算が開始される

---

### Edge Cases

- **同じレシピを複数回追加しようとした場合**: 既存の数量に加算するか、エラーを表示するか？（推奨: 既存の数量を増加、または数量変更UIへ誘導）
- **数量に0または負の数を入力した場合**: 入力を無効として扱い、最小値1を適用する
- **数量に非常に大きな数（例：9999）を入力した場合**: 上限を設定し、超過した場合は上限値を適用（推奨: 上限99）
- **レシピが1つも選択されていない場合**: 「レシピを追加してください」などのガイダンスを表示
- **「ごちゃまぜ」系レシピ（食材数0）を選択した場合**: 正常に処理し、食材合計に影響しないことを表示

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: システムは必要食材計算機のUI画面を提供しなければならない
- **FR-002**: ユーザーはレシピを1つ以上選択できなければならない
- **FR-003**: ユーザーは各レシピの作成数量（1〜99）を指定できなければならない
- **FR-004**: システムは選択されたレシピと数量に基づき、必要な食材の合計を計算しなければならない
- **FR-005**: システムは同じ食材が複数のレシピで使用される場合、合算して表示しなければならない
- **FR-006**: システムはレシピ名で検索する機能を提供しなければならない
- **FR-007**: ユーザーは選択したレシピを個別に削除できなければならない
- **FR-008**: ユーザーはすべての選択をリセットできなければならない
- **FR-009**: システムは選択中のレシピ一覧（名前と数量）を表示しなければならない
- **FR-010**: システムは食材ごとの必要数を一覧で表示しなければならない
- **FR-011**: システムは必要食材の総数（全食材の合計）を表示しなければならない

### Key Entities

- **Recipe（料理）**: 既存エンティティ。`ingredients`配列と`ingredientCount`属性を使用
- **SelectedRecipe（選択されたレシピ）**: ユーザーが計算対象として選択したレシピと数量のペア
  - recipeId: number（レシピID）
  - quantity: number（作成数量、1〜99）
- **IngredientTotal（食材合計）**: 計算結果として表示する食材と合計数
  - name: string（食材名）
  - totalQuantity: number（必要合計数）

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: ユーザーは3秒以内にレシピを選択して計算結果を確認できる
- **SC-002**: レシピ追加/削除/数量変更時、計算結果は500ミリ秒以内に更新される
- **SC-003**: 検索結果は入力から300ミリ秒以内に表示される
- **SC-004**: すべてのレシピ（77種類）が選択候補として表示できる
- **SC-005**: 計算結果は常に正確である（手計算と一致する）

## Assumptions

- レシピデータは既存の`recipes.json`を使用する
- 計算はクライアントサイドで完結する（API不要）
- レシピのIDと名前は一意である
- 食材名は正規化されており、同名の食材は同一とみなせる

## Dependencies

- 既存のレシピスキーマ（`apps/web/src/lib/schemas/recipe.ts`）
- 既存のレシピデータ取得関数（`apps/web/src/lib/data/recipes.ts`）
- shadcn/ui コンポーネント（Select, Input, Button, Card等）

## Out of Scope

- 食材の所持数を入力して、作成可能な料理を逆算する機能
- 計算結果の保存・共有機能
- レシピの並び替え・ソート機能
- 鍋容量との連携（選択したレシピが鍋に収まるかのチェック）
- 計算結果のエクスポート機能（CSV、画像等）

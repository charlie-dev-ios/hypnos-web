# Feature Specification: 必要食材数計算機の改善

**Feature Branch**: `006-ingredient-calculator-improve`
**Created**: 2026-02-03
**Status**: Draft
**Input**: User description: "必要食材数計算機の改善: 鍋容量で絞り込みできるようにする、一覧から選択してから個数指定するフローではなく一覧で直接個数を指定できるようにする、料理カードの視認性を上げ総エナジーなど必要な情報をわかりやすく表示する"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 一覧で直接個数を指定する (Priority: P1)

ユーザーはレシピ一覧を見ながら、各レシピの作成数量を直接指定したい。現在の「選択してから別リストで個数変更」というフローではなく、一覧内で直接「+」「-」ボタンや数値入力で個数を指定できるようにする。これにより、操作ステップが減り、直感的に計算対象を管理できる。

**Why this priority**: ユーザー体験を最も大きく改善する機能であり、操作フローの根本的な改善となる。レシピを見ながら数量を決められることで、情報の往復が不要になる。

**Independent Test**: レシピ一覧で直接数量を増減し、選択中リストと食材合計に即座に反映されることを確認できる。

**Acceptance Scenarios**:

1. **Given** 計算機画面を表示している, **When** レシピカード上の「+」ボタンをクリックする, **Then** そのレシピが数量1で選択状態になり、食材合計に反映される
2. **Given** レシピが数量2で選択されている, **When** 「+」ボタンをクリックする, **Then** 数量が3に増加し、食材合計が更新される
3. **Given** レシピが数量1で選択されている, **When** 「-」ボタンをクリックする, **Then** レシピが選択解除され、食材合計から除外される
4. **Given** レシピが選択されている, **When** 数量入力フィールドに直接「5」と入力する, **Then** 数量が5に変更され、食材合計が更新される

---

### User Story 2 - 鍋容量でレシピを絞り込む (Priority: P2)

ユーザーは自分の鍋容量に基づいて、作成可能なレシピのみを表示したい。食材数が鍋容量を超えるレシピは計算対象にならないため、最初から表示を絞り込むことで効率的にレシピを選べる。

**Why this priority**: 実用性を高める重要な機能であり、P1の操作改善と組み合わせることでより効率的な操作が可能になる。

**Independent Test**: 鍋容量を選択し、その容量以下のレシピのみが表示されることを確認できる。

**Acceptance Scenarios**:

1. **Given** 計算機画面を表示している, **When** 鍋容量プリセット「Lv.3 (27)」を選択する, **Then** 食材数が27以下のレシピのみが表示される
2. **Given** 鍋容量フィルターが適用されている, **When** 「すべて」を選択する, **Then** すべてのレシピが表示される
3. **Given** 既にレシピが選択されている状態で, **When** 鍋容量を変更して選択中のレシピがフィルターから外れる場合, **Then** 選択状態は維持されたまま、一覧では非表示になる（選択済みリストには残る）

---

### User Story 3 - 料理カードの情報を見やすくする (Priority: P2)

ユーザーはレシピ一覧でエナジー（料理パワー）や食材数を見やすく確認したい。現在は情報が少なく、どのレシピを選ぶべきか判断しにくい。カードデザインを改善して必要な情報を一目で把握できるようにする。

**Why this priority**: P1の直接入力と同じ優先度で、視認性の向上はユーザー体験に直結する。

**Independent Test**: レシピカードにエナジー、食材数、料理種別が明確に表示されていることを確認できる。

**Acceptance Scenarios**:

1. **Given** 計算機画面を表示している, **When** レシピ一覧を見る, **Then** 各カードにレシピ名、エナジー（料理パワー）、食材数、料理種別が表示されている
2. **Given** レシピカードを見ている, **When** エナジーの値を確認する, **Then** 数値と単位がわかりやすく表示されている（例：「1,500 EP」）
3. **Given** レシピが選択されている, **When** カードの表示を確認する, **Then** 選択状態と数量が視覚的に明確である

---

### User Story 4 - 選択中のレシピの合計エナジーを確認する (Priority: P3)

ユーザーは選択したレシピの合計エナジー（料理パワー）を確認したい。これにより、目標のエナジーに対してどれだけ貢献できるかを把握できる。

**Why this priority**: 付加的な情報であり、食材計算という主機能の補助となる。

**Independent Test**: レシピを選択すると、合計エナジーが表示されることを確認できる。

**Acceptance Scenarios**:

1. **Given** 複数のレシピが選択されている, **When** 選択済みエリアを確認する, **Then** 選択したレシピの合計エナジーが表示される
2. **Given** 合計エナジーが表示されている, **When** レシピを追加/削除する, **Then** 合計エナジーが即座に更新される

---

### Edge Cases

- **数量を0以下にしようとした場合**: レシピを選択解除する
- **数量に99を超える値を入力した場合**: 99を上限として適用する
- **鍋容量変更で選択中のレシピがフィルター外になった場合**: 選択は維持するが、一覧では非表示（選択済みリストでは確認・操作可能）
- **エナジーが0のレシピ（ごちゃまぜ系）の場合**: 0 EPとして表示し、合計にも反映する

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: システムはレシピ一覧の各カード上で数量を直接指定できるUIを提供しなければならない
- **FR-002**: ユーザーは「+」「-」ボタンで数量を1ずつ増減できなければならない
- **FR-003**: ユーザーは数量入力フィールドで直接数値（1〜99）を入力できなければならない
- **FR-004**: システムは鍋容量でレシピをフィルタリングできなければならない
- **FR-005**: システムはポケモンスリープの標準的な鍋サイズをプリセットとして提供しなければならない
- **FR-006**: システムはレシピカードにエナジー（料理パワー）を表示しなければならない
- **FR-007**: システムは選択したレシピの合計エナジーを表示しなければならない
- **FR-008**: 既存の検索・料理種別フィルター機能は維持しなければならない
- **FR-009**: 数量0または負の値は選択解除として扱わなければならない
- **FR-010**: 数量の上限は99としなければならない

### Key Entities

- **Recipe（料理）**: 既存エンティティ。`energy`（料理パワー）、`ingredientCount`（食材数）属性を使用
- **SelectedRecipe（選択されたレシピ）**: 既存エンティティ。レシピIDと数量のペア
- **PotCapacityFilter（鍋容量フィルター）**: 新規。選択可能な鍋容量値（プリセットまたはカスタム）

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: ユーザーは一覧から直接数量変更でき、以前の2ステップ操作が1ステップに短縮される
- **SC-002**: 数量変更時、計算結果は500ミリ秒以内に更新される
- **SC-003**: 鍋容量フィルター適用時、一覧が即座に更新される
- **SC-004**: すべてのレシピカードでエナジーと食材数が明確に視認できる
- **SC-005**: 選択したレシピの合計エナジーが正確に計算される

## Assumptions

- 既存の計算機UIのレイアウト（2カラム構成）は維持する
- 既存の検索・料理種別フィルター機能との互換性を保つ
- レシピデータの`energy`フィールドは全レシピで利用可能
- 鍋容量の標準プリセットは004-pot-capacity-filterで定義されたものを使用

## Dependencies

- 既存の計算機コンポーネント（`apps/web/src/components/calculator/`）
- 既存のレシピスキーマ（`apps/web/src/lib/schemas/recipe.ts`）
- 鍋容量プリセットの定義（004-pot-capacity-filterを参照）
- shadcn/ui コンポーネント

## Out of Scope

- レシピ画像の表示
- レシピの並び替え・ソート機能
- 計算結果の保存・共有機能
- 選択済みリストの廃止（維持して併用可能にする）
